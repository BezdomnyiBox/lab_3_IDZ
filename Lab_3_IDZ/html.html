<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="style.css">
  <script src="http://d3js.org/d3.v7.min.js"> </script>
</head>

<body onload="drawGraph(this.form)">
  <h3>Список самых высоких зданий</h3>
  <div>
    <form>
      <p>Вид графика</p>
      <input type="radio" name="type" id="typeC" value="Точечный" checked>Точечный<br>
      <input type="radio" name="type" id="typeR" value="Столбчатый">Столбчатый<br>
      <p>Значениe по оси OX</p>
      <input type="radio" name="ox" value="Страна" checked>Страна<br>
      <input type="radio" name="ox" value="Год">Год<br>
      <p>Значениe по оси OY</p>
      <input type="checkbox" id="oyMax" checked>Максимальная высота<br>
      <input type="checkbox" id="oyMin">Минимальная высота<br>
      <p>
        <input type=button value="Построить" onclick="drawGraph(this.form)">
      </p>
    </form>
    <svg height="5">
    </svg>
  </div>

  <div class="table">
    <p>
      <input type=button id="showTable" value="Показать таблицу">
    </p>
    <table>
    </table>
  </div>

  <script>
    let buildings = [

      {
        "Название": "Бурдж-Халифа",
        "Тип": "Небоскрёб",
        "Страна": "ОАЭ",
        "Город": "Дубай",
        "Год": 2010,
        "Высота": 828,
        "Этажность": 163
      },
      {
        "Название": "Варшавская радиомачта",
        "Тип": "Антенная мачта",
        "Страна": "Польша",
        "Город": "Константинов",
        "Год": 1974,
        "Высота": 646.38,
        "Этажность": "-"
      },
      {
        "Название": "Tokyo Skytree",
        "Тип": "Бетонная башня",
        "Страна": "Япония",
        "Город": "Токио",
        "Год": 2012,
        "Высота": 634,
        "Этажность": "-"
      },
      {
        "Название": "Шанхайская башня",
        "Тип": "Небоскрёб",
        "Страна": "КНР",
        "Город": "Шанхай",
        "Год": 2013,
        "Высота": 632,
        "Этажность": 121
      },
      {
        "Название": "Телерадиомачта KVLY-TV",
        "Тип": "Радиомачта",
        "Страна": "США",
        "Город": "Бланчард",
        "Год": 1963,
        "Высота": 629,
        "Этажность": "-"
      },
      {
        "Название": "Телебашня Гуанчжоу",
        "Тип": "Гиперболоидная башня",
        "Страна": "КНР",
        "Город": "Гуанчжоу",
        "Год": 2009,
        "Высота": 600,
        "Этажность": "-"
      },
      {
        "Название": "Международный финансовый центр Пинань",
        "Тип": "Небоскрёб",
        "Страна": "КНР",
        "Город": "Шэньчжэнь",
        "Год": 2017,
        "Высота": 600,
        "Этажность": 115
      },
      {
        "Название": "Lotte World Tower",
        "Тип": "Небоскрёб",
        "Страна": "Южная Корея",
        "Город": "Сеул",
        "Год": 2017,
        "Высота": 555,
        "Этажность": 123
      },
      {
        "Название": "Си-Эн Тауэр",
        "Тип": "Бетонная башня",
        "Страна": "Канада",
        "Город": "Торонто",
        "Год": 1976,
        "Высота": 553,
        "Этажность": "-"
      },
      {
        "Название": "Останкинская башня",
        "Тип": "Бетонная башня",
        "Страна": "Россия",
        "Город": "Москва",
        "Год": 1967,
        "Высота": 540.1,
        "Этажность": "-"
      },
      {
        "Название": "Уиллис-тауэр",
        "Тип": "Небоскрёб",
        "Страна": "США",
        "Город": "Чикаго",
        "Год": 1974,
        "Высота": 527.3,
        "Этажность": 110
      },
      {
        "Название": "Тайбэй 101",
        "Тип": "Небоскрёб",
        "Страна": "Тайвань",
        "Город": "Тайбэй",
        "Год": 2004,
        "Высота": 509.2,
        "Этажность": 101
      },
      {
        "Название": "Шанхайский всемирный финансовый центр",
        "Тип": "Небоскрёб",
        "Страна": "КНР",
        "Город": "Шанхай",
        "Год": 2008,
        "Высота": 492,
        "Этажность": 101
      },
      {
        "Название": "Международный коммерческий центр",
        "Тип": "Небоскрёб",
        "Страна": "Гонконг",
        "Город": "Гонконг",
        "Год": 2009,
        "Высота": 484,
        "Этажность": 118
      },
      {
        "Название": "Восточная жемчужина",
        "Тип": "Бетонная башня",
        "Страна": "КНР",
        "Город": "Шанхай",
        "Год": 1994,
        "Высота": 467.9,
        "Этажность": "-"
      },
      {
        "Название": "Лахта-центр",
        "Тип": "Небоскрёб",
        "Страна": "Россия",
        "Город": "Санкт-Петербург",
        "Год": 2018,
        "Высота": 462,
        "Этажность": 88
      },
      {
        "Название": "Landmark 81",
        "Тип": "Небоскрёб",
        "Страна": "Вьетнам",
        "Город": "Хошимин",
        "Год": 2018,
        "Высота": 461.2,
        "Этажность": 81
      },
      {
        "Название": "875 Норт-Мичиган-авеню",
        "Тип": "Небоскрёб",
        "Страна": "США",
        "Город": "Чикаго",
        "Год": 1969,
        "Высота": 457.2,
        "Этажность": 100
      },
      {
        "Название": "Петронас. башня 1 и 2",
        "Тип": "Небоскрёб",
        "Страна": "Малайзия",
        "Город": "Куала-Лумпур",
        "Год": 1998,
        "Высота": 452,
        "Этажность": 88
      },
      {
        "Название": "Финансовый центр Наньцзин-Гринлэнд",
        "Тип": "Небоскрёб",
        "Страна": "КНР",
        "Город": "Нанкин",
        "Год": 2009,
        "Высота": 450,
        "Этажность": 66
      },
      {
        "Название": "Эмпайр-стейт-билдинг",
        "Тип": "Небоскрёб",
        "Страна": "США",
        "Город": "Нью-Йорк",
        "Год": 1931,
        "Высота": 448.7,
        "Этажность": 102
      },
      {
        "Название": "Международный финансовый центр. башня зап.",
        "Тип": "Небоскрёб",
        "Страна": "КНР",
        "Город": "Гуанчжоу",
        "Год": 2010,
        "Высота": 437.5,
        "Этажность": 103
      },
      {
        "Название": "Kingkey 100",
        "Тип": "Небоскрёб",
        "Страна": "КНР",
        "Город": "Шэньчжэнь",
        "Год": 2011,
        "Высота": 439.8,
        "Этажность": 100
      },
      {
        "Название": "Бордже Милад",
        "Тип": "Бетонная башня",
        "Страна": "Иран",
        "Город": "Тегеран",
        "Год": 2003,
        "Высота": 435,
        "Этажность": "-"
      },
      {
        "Название": "Парк-авеню. 432",
        "Тип": "Небоскрёб",
        "Страна": "США",
        "Город": "Нью-Йорк",
        "Год": 2015,
        "Высота": 425.5,
        "Этажность": 85
      },
      {
        "Название": "Международная гостиница и башня Трампа",
        "Тип": "Небоскрёб",
        "Страна": "США",
        "Город": "Чикаго",
        "Год": 2009,
        "Высота": 423.4,
        "Этажность": 96
      },
      {
        "Название": "Менара Куала-Лумпур",
        "Тип": "Бетонная башня",
        "Страна": "Малайзия",
        "Город": "Куала-Лумпур",
        "Год": 1995,
        "Высота": 421,
        "Этажность": "-"
      },
      {
        "Название": "Цзинь Мао",
        "Тип": "Небоскрёб",
        "Страна": "КНР",
        "Город": "Шанхай",
        "Год": 1999,
        "Высота": 420.5,
        "Этажность": 88
      },
      {
        "Название": "Экибастузская ГРЭС-2",
        "Тип": "Дымовая труба",
        "Страна": "Казахстан",
        "Город": "Экибастуз",
        "Год": 1987,
        "Высота": 419.7,
        "Этажность": "-"
      },
      {
        "Название": "Международный финансовый центр",
        "Тип": "Небоскрёб",
        "Страна": "Гонконг",
        "Город": "Гонконг",
        "Год": 2003,
        "Высота": 415.8,
        "Этажность": 88
      },
      {
        "Название": "Тяньцзиньская телебашня",
        "Тип": "Бетонная башня",
        "Страна": "КНР",
        "Город": "Тяньцзинь",
        "Год": 1991,
        "Высота": 415.2,
        "Этажность": "-"
      },
      {
        "Название": "Башня Аль-Хамра",
        "Тип": "Небоскрёб",
        "Страна": "Кувейт",
        "Город": "Кувейт",
        "Год": 2010,
        "Высота": 412,
        "Этажность": 77
      },
      {
        "Название": "Пекинская телебашня",
        "Тип": "Бетонная башня",
        "Страна": "КНР",
        "Город": "Пекин",
        "Год": 1992,
        "Высота": 405,
        "Этажность": "-"
      },
      {
        "Название": "Башня CITIC",
        "Тип": "Небоскрёб",
        "Страна": "КНР",
        "Город": "Гуанчжоу",
        "Год": 1997,
        "Высота": 391.1,
        "Этажность": 80
      },
      {
        "Название": "Киевская телебашня",
        "Тип": "Решётчатая мачта",
        "Страна": "Украина",
        "Город": "Киев",
        "Год": 1973,
        "Высота": 385,
        "Этажность": "-"
      },
      {
        "Название": "Башня Сёньхин",
        "Тип": "Небоскрёб",
        "Страна": "КНР",
        "Город": "Шэньчжэнь",
        "Год": 1996,
        "Высота": 384,
        "Этажность": 69
      },
      {
        "Название": "Абу-Даби Плаза",
        "Тип": "Небоскрёб",
        "Страна": "Казахстан",
        "Город": "Астана",
        "Год": 2015,
        "Высота": 382,
        "Этажность": 88
      },
      {
        "Название": "Бурдж-Мохаммед-бин-Рашид",
        "Тип": "Небоскрёб",
        "Страна": "ОАЭ",
        "Город": "Абу-Даби",
        "Год": 2014,
        "Высота": 381,
        "Этажность": 88
      },
      {
        "Название": "Inco Superstack",
        "Тип": "Дымовая труба",
        "Страна": "Канада",
        "Город": "Copper Cliff",
        "Год": 1971,
        "Высота": 380,
        "Этажность": "-"
      },
      {
        "Название": "Тантекс-Скай-Тауэр",
        "Тип": "Небоскрёб",
        "Страна": "Тайвань",
        "Город": "Гаосюн",
        "Год": 1997,
        "Высота": 378,
        "Этажность": 85
      },
      {
        "Название": "JW Marriott Marquis Dubai. 1 и 2",
        "Тип": "Небоскрёб",
        "Страна": "ОАЭ",
        "Город": "Дубай",
        "Год": 2010,
        "Высота": 376,
        "Этажность": 77
      },
      {
        "Название": "Ташкентская телебашня",
        "Тип": "Башня",
        "Страна": "Узбекистан",
        "Город": "Ташкент",
        "Год": 1985,
        "Высота": 374.9,
        "Этажность": "-"
      },
      {
        "Название": "Башня Федерация «Восток»",
        "Тип": "Небоскрёб",
        "Страна": "Россия",
        "Город": "Москва",
        "Год": 2016,
        "Высота": 374,
        "Этажность": 97
      },
      {
        "Название": "Сентрал-плаза",
        "Тип": "Небоскрёб",
        "Страна": "Гонконг",
        "Город": "Гонконг",
        "Год": 1992,
        "Высота": 374,
        "Этажность": 78
      },
      {
        "Название": "Башня Освобождения",
        "Тип": "Бетонная башня",
        "Страна": "Кувейт",
        "Город": "Кувейт",
        "Год": 1996,
        "Высота": 372,
        "Этажность": "-"
      },
      {
        "Название": "Телебашня «Коктобе»",
        "Тип": "Башня",
        "Страна": "Казахстан",
        "Город": "Алматы",
        "Год": 1983,
        "Высота": 371.5,
        "Этажность": "-"
      },
      {
        "Название": "Дымовая труба электростанции",
        "Тип": "Дымовая труба",
        "Страна": "США",
        "Город": "Homer City",
        "Год": 1977,
        "Высота": 371,
        "Этажность": "-"
      },
      {
        "Название": "Дымовая труба Берёзовской ГРЭС",
        "Тип": "Дымовая труба",
        "Страна": "Россия",
        "Город": "Шарыпово",
        "Год": 1985,
        "Высота": 370,
        "Этажность": "-"
      },
      {
        "Название": "Рижская телебашня",
        "Тип": "Бетонная башня",
        "Страна": "Латвия",
        "Город": "Рига",
        "Год": 1987,
        "Высота": 368.5,
        "Этажность": "-"
      },
      {
        "Название": "Берлинская телебашня",
        "Тип": "Бетонная башня",
        "Страна": "Германия",
        "Город": "Берлин",
        "Год": 1969,
        "Высота": 368,
        "Этажность": "-"
      },
      {
        "Название": "Дымовая труба электростанции.",
        "Тип": "Дымовая труба",
        "Страна": "США",
        "Город": "Маундсвилл",
        "Год": 1968,
        "Высота": 367.6,
        "Этажность": "-"
      },
      {
        "Название": "Башня Банка Китая",
        "Тип": "Небоскрёб",
        "Страна": "Гонконг",
        "Город": "Гонконг",
        "Год": 1990,
        "Высота": 367.4,
        "Этажность": 70
      },
      {
        "Название": "Башня Банка Америки",
        "Тип": "Небоскрёб",
        "Страна": "США",
        "Город": "Нью-Йорк",
        "Год": 2008,
        "Высота": 366,
        "Этажность": 54
      },
      {
        "Название": "Башня Алмас",
        "Тип": "Небоскрёб",
        "Страна": "ОАЭ",
        "Город": "Дубай",
        "Год": 2008,
        "Высота": 363,
        "Этажность": 68
      },
      {
        "Название": "Дымовая труба электростанции в Трбовле",
        "Тип": "Дымовая труба",
        "Страна": "Словения",
        "Город": "Трбовле",
        "Год": 1976,
        "Высота": 360,
        "Этажность": "-"
      },
      {
        "Название": "Endesa Termic ",
        "Тип": "Дымовая труба",
        "Страна": "Испания",
        "Город": "Ферроль",
        "Год": 1974,
        "Высота": 356,
        "Этажность": "-"
      },
      {
        "Название": "SEG Plaza",
        "Тип": "Небоскрёб",
        "Страна": "КНР",
        "Город": "Шэньчжэнь",
        "Год": 2000,
        "Высота": 355.8,
        "Этажность": 70
      },
      {
        "Название": "First Canadian Place",
        "Тип": "Небоскрёб",
        "Страна": "Канада",
        "Город": "Торонто",
        "Год": 1976,
        "Высота": 355,
        "Этажность": 72
      },
      {
        "Название": "Эмиратская офисная башня",
        "Тип": "Небоскрёб",
        "Страна": "ОАЭ",
        "Город": "Дубай",
        "Год": 2000,
        "Высота": 354.6,
        "Этажность": 54
      },
      {
        "Название": "ОКО Южная башня",
        "Тип": "Небоскрёб",
        "Страна": "Россия",
        "Город": "Москва",
        "Год": 2015,
        "Высота": 354,
        "Этажность": 85
      },
      {
        "Название": "Виннцкая телемачта",
        "Тип": "Радиомачта",
        "Страна": "Украина",
        "Город": "Винница",
        "Год": 1961,
        "Высота": 354,
        "Этажность": 54
      },
      {
        "Название": "Медеплавильный завод",
        "Тип": "Дымовая труба",
        "Страна": "Румыния",
        "Город": "Бая-Маре",
        "Год": 1995,
        "Высота": 351.5,
        "Этажность": "-"
      },
      {
        "Название": "Стратосфера Лас-Вегас",
        "Тип": "Бетонная башня",
        "Страна": "США",
        "Город": "Лас-Вегас",
        "Год": 1996,
        "Высота": 350.2,
        "Этажность": "-"
      },
      {
        "Название": "Дымовая труба Сырдарьинской электростанции",
        "Тип": "Дымовая труба",
        "Страна": "Узбекистан",
        "Город": "Сырдарья",
        "Год": 1980,
        "Высота": 350,
        "Этажность": "-"
      }
    ]
    // получить кнопку с id showTable
    element = document.getElementById("showTable");
    element.onclick = function () {
      if (this.value === "Показать таблицу") {


        this.value = "Скрыть таблицу";
        // создать таблицу, вывести ее содержимое
        // см. стр. 9-10 Теоретического материала к ЛР
        d3.select("div.table")
          .select("table")
          .selectAll("tr")
          .data(buildings)
          .enter()
          .append('tr');

        d3.select("div.table")
          .select("table")
          .selectAll("tr")
          .data(buildings)
          .html(function (d) {
            return `<td>${d.Название}</td><td>${d.Тип}</td><td>${d.Страна}</td><td>${d.Город}</td><td>${d.Год}</td><td>${d.Высота}</td><td>${d.Этажность}</td>`;
          })
          .style("display", "");

        // добавить в начало таблицы строку заголовков
        let headers = ["Название", "Тип", "Страна", "Город", "Год", "Высота", "Этажность"];
        d3.select("div.table")
          .select("table")
          .insert("tr", "tr");

        d3.select("div.table")
          .select("table")
          .select("tr")
          .selectAll("th")
          .data(headers)
          .enter()
          .append("th")
          .text(function (d) { return d; });
      }
      else {
        this.value = "Показать таблицу";
        // удалить строки таблицы
        d3.select("div.table")
          .select("table")
          .selectAll("tr")
          .style("display", "none");
      }
    };

    // Входные данные:
    // arrObject - исходный массив (например, buildings)
    // fieldX - поле, различные значения которого будут отображаться на оси ОХ
    // fieldY - поле, минимальное и максимальное значение которого
    // вычисляется для каждой метки на оси ОХ
    // Результат - массив для построения диаграммы

    function getArrGraph(arrObject, fieldX, fieldY) {
      // сформируем список меток по оси OX (различные элементы поля fieldX)
      // см. стр. 8-9 Теоретического материала к ЛР
      let groupObj = d3.group(arrObject, d => d[fieldX]);
      arrGroup = []; // массив объектов для построения графика
      for (let entry of groupObj) {
        //выделяем минимальное и максимальное значения поля fieldY
        //для очередной метки по оси ОХ
        let minMax = d3.extent(entry[1].map(d => d[fieldY]));
        let elementGroup = {};
        elementGroup.labelX = entry[0];
        elementGroup.valueMin = minMax[0];
        elementGroup.valueMax = minMax[1];
        arrGroup.push(elementGroup);
      }
      return arrGroup;
    }

    function drawGraph(data) {
      let ox = document.getElementsByName("ox");
      let value = '';
      if(ox[0].checked){
        value = ox[0].value;
      }
      if(ox[1].checked){
        value = ox[1].value;
      }


      // формируем массив для построения диаграммы
      let arrGraph = getArrGraph(buildings, value, "Высота")
      let marginX = 50;
      let marginY = 50;
      let height = 400;
      let width = 800;

      let svg = d3.select("svg")
        .attr("height", height)
        .attr("width", width);

      // очищаем svg перед построением
      svg.selectAll("*").remove();
      // определяем минимальное и максимальное значение по оси OY
      let min = d3.min(arrGraph.map(d => d.valueMin)) * 0.95;
      let max = d3.max(arrGraph.map(d => d.valueMax)) * 1.05;
      let xAxisLen = width - 2 * marginX;
      let yAxisLen = height - 2 * marginY;

      // определяем шкалы для осей
      let scaleX = d3.scaleBand()
        .domain(arrGraph.map(function (d) {
          return d.labelX;
        })
        )
        .range([0, xAxisLen], 1);

      let scaleY = d3.scaleLinear()
        .domain([min, max])
        .range([yAxisLen, 0]);
      // создаем оси
      let axisX = d3.axisBottom(scaleX); // горизонтальная

      let axisY = d3.axisLeft(scaleY);// вертикальная

      // отображаем ось OX, устанавливаем подписи оси ОX и угол их наклона
      svg.append("g")
        .attr("transform", `translate(${marginX}, ${height - marginY})`)
        .call(axisX)
        .attr("class", "x-axis")
        .selectAll("text")
        .style("text-anchor", "end")
        .attr("dx", "-.8em")
        .attr("dy", ".15em")
        .attr("transform", function (d) {
          return "rotate(-45)";
        });

      // отображаем ось OY
      svg.append("g")
        .attr("transform", `translate(${marginX}, ${marginY})`)
        .attr("class", "y-axis")
        .call(axisY);

      // создаем набор вертикальных линий для сетки
      d3.selectAll("g.x-axis g.tick")
        .append("line") // добавляем линию
        .classed("grid-line", true) // добавляем класс
        .attr("x1", 0)
        .attr("y1", 0)
        .attr("x2", 0)
        .attr("y2", - (yAxisLen));

      // создаем горизонтальные линии сетки
      d3.selectAll("g.y-axis g.tick")
        .append("line")
        .classed("grid-line", true)
        .attr("x1", 0)
        .attr("y1", 0)
        .attr("x2", xAxisLen)
        .attr("y2", 0);

      let maxCheck = document.getElementById("oyMax");
      let minCheck = document.getElementById("oyMin");
      let circleCheck = document.getElementById("typeC");
      let rectCheck = document.getElementById("typeR");

      // отображаем данные в виде точечной диаграммы
      if (maxCheck.checked) {
        if (rectCheck.checked) {
          svg.selectAll("rect")
            .data(arrGraph)
            .enter()
            .append("rect")
            .attr("x", function (d) { return scaleX(d.labelX); })
            .attr("y", function (d) { return scaleY(d.valueMax); })
            .attr("width", 15)
            .attr("height", function (d) { return (300 - scaleY(d.valueMax)); })
            .style("fill", "none")
            .style("stroke", "red")
            .style("stroke-width", "2")
            .attr("transform",
              `translate(${marginX + scaleX.bandwidth() / 2}, ${marginY})`);
        }
        if (circleCheck.checked) {
          svg.selectAll(".dot")
            .data(arrGraph)
            .enter()
            .append("circle")
            .attr("r", 5)
            .attr("cx", function (d) { return scaleX(d.labelX); })
            .attr("cy", function (d) { return scaleY(d.valueMax); })
            .attr("transform",
              `translate(${marginX + scaleX.bandwidth() / 2}, ${marginY})`)
            .style("fill", "red");
        }
      }
      if (minCheck.checked) {
        if (circleCheck.checked) {
          svg.selectAll(".dot")
            .data(arrGraph)
            .enter()
            .append("circle")
            .attr("r", 5)
            .attr("cx", function (d) { return scaleX(d.labelX); })
            .attr("cy", function (d) { return scaleY(d.valueMin); })
            .attr("transform",
              `translate(${marginX + scaleX.bandwidth() / 2}, ${marginY})`)
            .style("fill", "blue");
        }
        if (rectCheck.checked) {
          svg.selectAll("rect.blue")
            .data(arrGraph)
            .enter()
            .append("rect")
            .attr("class","blue")
            .attr("x", function (d) { return scaleX(d.labelX); })
            .attr("y", function (d) { return scaleY(d.valueMin); })
            .attr("width", 20)
            .attr("height", function (d) { return (300 - scaleY(d.valueMin)); })
            .style("fill", "blue")
            .attr("transform",
              `translate(${marginX + scaleX.bandwidth() / 2}, ${marginY})`);
        }
      }
      if (!maxCheck.checked && !minCheck.checked) {
        alert("Ошибка, выберите значение по оси OY");
      }
    }


  </script>
</body>
<!-- <script src="program.js"></script>
<script src="data.js"></script> -->

</html>